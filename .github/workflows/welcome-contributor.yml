name: Welcome New Contributor

on:
  pull_request:
    types: [closed]
    paths:
      - 'data/members.json'

jobs:
  welcome:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    
    steps:
      - name: Add contributor badge
        uses: actions/github-script@v7
        with:
          script: |
            const username = context.payload.pull_request.user.login;
            
            // Add label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              labels: ['âœ… merged', 'ğŸ‰ new-member']
            });
            
            // Thank you comment
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.payload.pull_request.number,
              body: `ğŸŠ **Congratulations @${username}!**\n\nYou're now officially part of the IKPC Town Board! ğŸ˜ï¸\n\nâœ¨ Your avatar is live at: [View the board](https://your-org.github.io/ikpc-town-board)\n\nğŸ“Œ You're now a **contributor** to this project!\n\nFeel free to:\n- Share the board with friends\n- Contribute improvements (see [CONTRIBUTING.md](CONTRIBUTING.md))\n- Join our Discord community\n\nThanks for being part of the town! ğŸ™Œ`
            });

      - name: Invite to organization
        if: secrets.ORG_INVITE_TOKEN != ''
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.ORG_INVITE_TOKEN }}
          script: |
            const username = context.payload.pull_request.user.login;
            const orgName = context.repo.owner;
            
            try {
              await github.rest.orgs.createInvitation({
                org: orgName,
                invitee_id: context.payload.pull_request.user.id,
                role: 'member'
              });
              
              console.log(`âœ… Invited @${username} to ${orgName} organization`);
              
              // Comment about org invite
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: `ğŸ“§ **Organization Invite Sent!**\n\n@${username}, check your email for an invitation to join the **${orgName}** organization as a member! ğŸ‰`
              });
            } catch (error) {
              console.log(`âš ï¸ Could not invite @${username}: ${error.message}`);
            }

